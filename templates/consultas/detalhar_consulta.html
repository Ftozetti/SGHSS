{% extends 'base.html' %}
{% block content %}
<h2>Consulta com {{ consulta.paciente.get_full_name }} â€“ {{ consulta.data }} {{ consulta.horario_inicio }}</h2>

{% if form_observacoes %}
<form method="post">
    {% csrf_token %}
    <div class="mb-3">
        <label for="{{ form_observacoes.observacoes_visiveis.id_for_label }}">ObservaÃ§Ãµes ao Paciente</label>
        {{ form_observacoes.observacoes_visiveis }}
    </div>
    <div class="mb-3">
        <label for="{{ form_observacoes.observacoes_internas.id_for_label }}">ObservaÃ§Ãµes Internas</label>
        {{ form_observacoes.observacoes_internas }}
    </div>
    <button type="submit" class="btn btn-primary">Salvar ObservaÃ§Ãµes</button>
</form>
{% else %}
<hr>
<h4>ObservaÃ§Ãµes ao Paciente</h4>
<p>{{ consulta.observacoes_visiveis|default:"Nenhuma observaÃ§Ã£o visÃ­vel." }}</p>

<h4>ObservaÃ§Ãµes Internas</h4>
<p>{{ consulta.observacoes_internas|default:"Nenhuma anotaÃ§Ã£o interna." }}</p>
{% endif %}

<br>
<div class="mb-3">
  <a href="{% url 'redirecionar_dashboard' %}" class="btn btn-secondary">ğŸ  Retornar Ã  Home</a>
</div>

<hr>

<a href="{% url 'emitir_laudo' consulta.id %}" class="btn btn-outline-primary">ğŸ“ Emitir Laudo</a>
<a href="{% url 'emitir_atestado' consulta.id %}" class="btn btn-outline-secondary">ğŸ“„ Emitir Atestado</a>
<a href="{% url 'emitir_receita' consulta.id %}" class="btn btn-outline-success">ğŸ’Š Emitir Receita</a>
<a href="{% url 'visualizar_prontuario' consulta.paciente.id %}" class="btn btn-outline-info">ğŸ“š ProntuÃ¡rio do Paciente</a>

<hr>

<h3>Documentos Emitidos</h3>

{% if consulta.laudos.all %}
  <h4>Laudos</h4>
  <ul>
    {% for laudo in consulta.laudos.all %}
      <li>
        Laudo de {{ laudo.criado_em|date:"d/m/Y H:i" }} â€”
        <a href="{% url 'visualizar_laudo' laudo.id %}" target="_blank">Download PDF</a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>Nenhum laudo emitido.</p>
{% endif %}

{% if consulta.receitas.all %}
  <h4>Receitas</h4>
  <ul>
    {% for receita in consulta.receitas.all %}
      <li>
        Receita de {{ receita.criado_em|date:"d/m/Y H:i" }} â€”
        <a href="{% url 'visualizar_receita' receita.id %}" target="_blank">Download PDF</a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>Nenhuma receita emitida.</p>
{% endif %}

{% if consulta.atestados.all %}
  <h4>Atestados</h4>
  <ul>
    {% for atestado in consulta.atestados.all %}
      <li>
        Atestado de {{ atestado.criado_em|date:"d/m/Y H:i" }} â€”
        <a href="{% url 'visualizar_atestado' atestado.id %}" target="_blank">Download PDF</a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>Nenhum atestado emitido.</p>
{% endif %}


<form method="post" action="{% url 'cancelar_atendimento' consulta.id %}" style="display:inline;">
  {% csrf_token %}
  <button type="submit" class="btn btn-warning">â†©ï¸ Cancelar Atendimento</button>
</form>

<form method="post" action="{% url 'encerrar_atendimento' consulta.id %}" style="display:inline;">
  {% csrf_token %}
  <button type="submit" class="btn btn-danger">âœ… Encerrar Consulta</button>
</form>

{% endblock %}
